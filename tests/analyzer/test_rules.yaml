# SuperBench rules
version: v0.4
superbench:
  rules:
    rule0:
      function: variance
      criteria: lambda x:x>0.05
      categories: KernelLaunch
      metrics:
        - kernel-launch/event_overhead:\d+
        - kernel-launch/wall_overhead:\d+
    rule1:
      function: variance
      criteria: "lambda x:x<-0.05"
      categories: Mem
      metrics:
        - mem-bw/H2D_Mem_BW:\d+
        - mem-bw/D2H_Mem_BW:\d+
    rule2:
      function: variance
      criteria: "lambda x:x<-0.05"
      upper_criteria: 'lambda label:True if label["rule2"]>=2 else False'
      store: True
      categories: CNN
      metrics:
        - densenet_models/pytorch-densenet169/throughput_train_.*
    rule3:
      function: variance
      criteria: "lambda x:x<-0.05"
      store: True
      categories: CNN
      metrics:
        - resnet_models/pytorch-resnet.*/throughput_train_.*
    rule4:
      function: variance
      criteria: "lambda x:x<-0.05"
      upper_criteria: 'lambda label:True if label["rule3"]+label["rule4"]>=2 else False'
      categories: CNN
      metrics:
        - vgg_models/pytorch-vgg.*/throughput_train_.*
    falure_rule:
      function: value
      criteria: "lambda x:x>0"
      categories: FailedTest
      metrics:
        - kernel-launch/return_code
        - mem-bw/return_code
